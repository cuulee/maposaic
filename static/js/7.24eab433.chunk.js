(this.webpackJsonpmaposaic=this.webpackJsonpmaposaic||[]).push([[7],{252:function(e,t,a){},256:function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));var n=.4},346:function(e,t,a){},456:function(e,t,a){},469:function(e,t,a){},470:function(e,t,a){},481:function(e,t,a){},492:function(e,t,a){"use strict";a.r(t),a.d(t,"UploadButton",(function(){return B}));var n,c,o=a(97),r=a.n(o),s=a(98),i=a(88),l=a(3),u=a(89),d=a(0),b=a.n(d),p=a(491),j=a(157),f=a(501),m=a(500),h=a(503),g=a(517),O=a(511),v=a(518),x=a(519),y=a(140),C=a(139),w=a(128),_=a(478),S="pictures",N="maposaic_pictures",k=function(e){return"".concat(N,"/").concat(e)},P=function(){var e=Object(s.a)(r.a.mark((function e(t){var a,n,c,o,s;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.documentId,n=t.payload,c=t.anonymousUid,o=E(n),!a){e.next=6;break}return C.a.collection(S).doc(a).update(o),e.abrupt("return",a);case 6:return e.prev=6,e.next=9,C.a.collection(S).add(Object(w.a)(Object(w.a)({},o),{},{anonymousUid:c,timestamp:y.a.firestore.FieldValue.serverTimestamp()}));case 9:return s=e.sent,e.abrupt("return",s.id);case 13:return e.prev=13,e.t0=e.catch(6),console.log(e.t0),e.abrupt("return",null);case 17:case"end":return e.stop()}}),e,null,[[6,13]])})));return function(t){return e.apply(this,arguments)}}(),E=function(e){var t={};return Object.keys(e).forEach((function(a){var n=e[a];void 0!==n&&(t[a]=n)})),t},I=a(141),T=(a(481),a(256)),A=a(1),L=a(186);!function(e){e.Error="error",e.Canceled="canceled",e.Running="running",e.Success="success"}(c||(c={}));var R=(n={},Object(u.a)(n,c.Error,"exception"),Object(u.a)(n,c.Canceled,"exception"),Object(u.a)(n,c.Running,"active"),Object(u.a)(n,c.Success,"success"),n),M=function(e){var t=e.taskState,a=e.documentId,n=Object(A.f)();return t?t===c.Canceled?Object(l.jsx)("div",{children:"Upload canceled"}):t===c.Running?Object(l.jsx)("div",{children:"Uploading picture..."}):t!==c.Error&&a&&t===c.Success?Object(l.jsxs)("div",{className:"status-message",children:["Picture uploaded !"," ",Object(l.jsx)("div",{className:"status-message__link",onClick:function(){return n.push("/gallery?".concat(L.a,"=").concat(a))},children:"show in gallery"})]}):Object(l.jsx)("div",{children:"Upload failed"}):Object(l.jsx)("div",{children:"No upload in progress"})},B=function(e){var t=e.isDisabled,a=e.onUploadClick;return Object(l.jsx)(p.a,{title:"Upload to public gallery",mouseEnterDelay:T.a,children:Object(l.jsx)(j.a,{disabled:t,type:"default",shape:"circle",onClick:a,icon:Object(l.jsx)(g.a,{})})})};t.default=function(e){var t=e.isDisabled,a=e.className,n=e.mapCenter,o=e.mapZoom,u=e.placeName,p=e.colorConfig,j=e.mapboxStyle,g=Object(d.useState)(!1),w=Object(i.a)(g,2),S=w[0],N=w[1],E=Object(d.useState)(0),T=Object(i.a)(E,2),A=T[0],L=T[1],U=Object(d.useState)(null),D=Object(i.a)(U,2),z=D[0],W=D[1],F=Object(d.useState)(null),Z=Object(i.a)(F,2),G=Z[0],H=Z[1],V=Object(d.useState)(""),J=Object(i.a)(V,2),Y=J[0],Q=J[1],X=Object(d.useState)(null),q=Object(i.a)(X,2),K=q[0],$=q[1],ee=Object(d.useState)(!1),te=Object(i.a)(ee,2),ae=te[0],ne=te[1],ce=Object(d.useState)(!1),oe=Object(i.a)(ce,2),re=oe[0],se=oe[1],ie=Object(d.useState)(null),le=Object(i.a)(ie,2),ue=le[0],de=le[1],be=Object(d.useState)(null),pe=Object(i.a)(be,2),je=pe[0],fe=pe[1];Object(d.useEffect)((function(){C.b.signInAnonymously(),y.a.auth().onAuthStateChanged((function(e){fe(e?e.uid:null)}))}),[]);var me=function(e){e&&"storage/canceled"===e.code&&W(c.Canceled),W(c.Error)},he=function(){var e=Object(s.a)(r.a.mark((function e(t){var a,s,i,l;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.downloadURL,i=t.fileId,e.next=3,P({documentId:ue,anonymousUid:je,payload:{downloadURL:s,filePath:k(i),mapCenter:null!==(a=null===n||void 0===n?void 0:n.toArray())&&void 0!==a?a:"",colorConfig:p,mapZoom:o,placeName:u,mapboxStyle:j}});case 3:l=e.sent,ye(l),W(l?c.Success:c.Error);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ge=Object(d.useCallback)(he,[ue,je]);Object(d.useEffect)((function(){if(G&&K){var e=G.on("state_changed",(function(e){!function(e){L(e.bytesTransferred/e.totalBytes*100),W(c.Running)}(e)}),(function(e){me(e)}),Object(s.a)(r.a.mark((function e(){var t;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,G.snapshot.ref.getDownloadURL();case 3:t=e.sent,ge({downloadURL:t,fileId:K}),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),me();case 10:case"end":return e.stop()}}),e,null,[[0,7]])}))));return function(){return e()}}}),[G,ge,K]);var Oe=function(){z&&[y.a.storage.TaskState.RUNNING,y.a.storage.TaskState.PAUSED].includes(z)&&G&&(G.cancel(),W(c.Canceled))};Object(d.useEffect)((function(){return ne(!1)}),[Y]);var ve=!Y.length||!z||![c.Running,c.Success].includes(z)||ae,xe=function(){var e=Object(s.a)(r.a.mark((function e(){var t;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!ve){e.next=2;break}return e.abrupt("return");case 2:return se(!0),e.next=5,P({documentId:ue,payload:{pictureName:Y},anonymousUid:je});case 5:t=e.sent,ye(t),se(!1),ne(!0);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ye=function(e){e&&!ue&&de(e)},Ce=function(e){var t=e.className;return re?Object(l.jsx)(O.a,{spin:!0,className:t,style:{color:I.b}}):ae?Object(l.jsx)(v.a,{className:t,twoToneColor:I.c}):Object(l.jsx)(x.a,{className:t,onClick:ve?void 0:xe,style:{color:ve?I.a:I.b}})};return Object(l.jsxs)("div",{className:a,children:[Object(l.jsx)(B,{isDisabled:t,onUploadClick:function(){if(N(!0),z!==c.Running){W(null),H(null),de(null),Q(null!==u&&void 0!==u?u:"");var e=document.getElementById("maposaic-canvas");e&&(L(0),e.toBlob((function(e){if(e){var t=function(e){var t=e.blob,a=Object(_.v4)(),n=k(a);return{fileId:a,uploadTask:C.c.ref(n).put(t)}}({blob:e}),a=t.uploadTask,n=t.fileId;H(a),$(n)}})))}}}),Object(l.jsxs)(f.a,{visible:S,onCancel:function(){Oe(),N(!1)},onOk:function(){ve||ae||xe(),N(!1)},children:[Object(l.jsx)(M,{documentId:ue,taskState:z}),z&&Object(l.jsx)(b.a.Fragment,{children:Object(l.jsx)(m.a,{percent:Math.round(A),size:"small",status:z?R[z]:void 0})}),Object(l.jsxs)("div",{className:"form",children:[Object(l.jsx)("div",{className:"form__title",children:"Picture name (optional)"}),Object(l.jsx)("div",{className:"form__field",children:Object(l.jsx)(h.a,{placeholder:"Picture name",value:Y,onChange:function(e){return Q(e.target.value)},suffix:Object(l.jsx)(Ce,{}),onPressEnter:xe})})]})]})]})}},499:function(e,t,a){"use strict";a.r(t);var n,c,o=a(3),r=a(97),s=a.n(r),i=a(98),l=a(89),u=a(88),d=a(0),b=a.n(d),p=a(120),j=a.n(p),f=(a(345),a(491)),m=a(157),h=a(520),g=a(521),O=a(522),v=a(1),x=a(66),y=a(34),C=a.p+"static/media/dice.f791ca4f.svg",w=a.p+"static/media/gps.fb5bd49f.svg",_=a(128),S=a(504),N=a(496),k=a(487),P=a(505),E=a(509),I=a(142),T=a.n(I),A=a(512),L=a(513),R=a(507),M=a(514),B=(a(346),a(508)),U=a(510),D=a(261),z=a(115),W=a(110),F=(a(456),a(250)),Z=a(188),G=function(e,t,a){return{r:e,g:t,b:a}},H=function(e){return G(parseInt(e.slice(1,3),16),parseInt(e.slice(3,5),16),parseInt(e.slice(5,7),16))},V=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],J=function(e){return"".concat(V[Math.floor(e/16)]||0).concat(V[e%16]||0)},Y=function(e){return"#".concat(J(e.r)).concat(J(e.g)).concat(J(e.b))},Q=function(e){return e===W.a.Random?G(Math.floor(256*Math.random()),Math.floor(256*Math.random()),Math.floor(256*Math.random())):H("string"===typeof e?e:e[Math.floor(Math.random()*e.length)])},X=function(e){return e.type===W.a.Random?W.a.Random:e.type===W.a.Shading?e.shadingType===W.e.Custom?Object(Z.d)(e.seedColor):z.a[e.seedColor]:e.paletteType===W.c.Preset?z.e[e.origin].palettes[e.paletteIndex]:e.colors},q=function(e,t){return function(e,t){if("object"!==typeof e)return e;var a=new Set;for(var n in t)t[n].color&&a.add(t[n].color);var c,o=[],r=Object(F.a)(e);try{for(r.s();!(c=r.n()).done;){var s=c.value;a.has(s)||o.push(s)}}catch(i){r.e(i)}finally{r.f()}return o}(X(e),t)},K=function(e,t){return e.type===W.a.Palette&&e.paletteType===W.c.Preset&&e.origin===t?e.paletteIndex:0},$=a(490),ee=a(457),te=a.n(ee),ae=(a(252),function(e){var t,a=e.colorConfig,n=e.setColorConfig,c=e.shadingColorConfig,r=e.setShadingColorConfig,s=(e.paletteColorConfig,e.setPaletteColorConfig),i=Object(d.useState)(a.type===W.a.Shading&&a.shadingType===W.e.Custom?a.seedColor:"#3c22c3"),b=Object(u.a)(i,2),p=b[0],j=b[1],f=Object(d.useState)(a.type===W.a.Palette?a.paletteType===W.c.Preset?a.origin:W.c.Custom:W.b.Coolors),m=Object(u.a)(f,2),h=m[0],g=m[1],O=Object(d.useState)((t={},Object(l.a)(t,W.b.Coolors,K(a,W.b.Coolors)),Object(l.a)(t,W.b.ColorHunt,K(a,W.b.ColorHunt)),t)),v=Object(u.a)(O,2),x=v[0],y=v[1],C=Object(d.useState)(a.type===W.a.Palette&&a.paletteType===W.c.Custom?a.colors:["#f3d2a6","#13dff6"]),w=Object(u.a)(C,2),S=w[0],N=w[1],P=function(e){e.type===W.a.Shading?r(e):e.type===W.a.Palette&&s(e),n(e)},E=function(e){j(e),P(Object(_.a)(Object(_.a)({},c),{},{shadingType:W.e.Custom,seedColor:e}))},I=function(e,t){var a=Object($.a)(S);return a[t]=e.hex.toLocaleLowerCase(),N(a),a};return a.type===W.a.Shading?Object(o.jsxs)("div",{className:"settings",children:[Object(o.jsxs)("div",{className:"shading-settings__type",children:[Object(o.jsx)("div",{className:"shading-settings__type__name",children:"Preset"}),Object(o.jsx)("div",{className:"shading-settings__type__presets",children:Object.entries(W.d).map((function(e){var t=Object(u.a)(e,2),a=t[0],n=t[1];return Object(o.jsx)("div",{className:"shading-color".concat(c.shadingType===W.e.Preset&&c.seedColor===n?" shading-color--selected":""),onClick:function(){return e=n,void P(Object(_.a)(Object(_.a)({},c),{},{shadingType:W.e.Preset,seedColor:e}));var e},children:Object(o.jsx)("div",{className:"shading-color__fill",style:{backgroundColor:z.a[n].primary}})},a)}))})]}),Object(o.jsxs)("div",{className:"shading-settings__type",children:[Object(o.jsx)("div",{className:"shading-settings__type__name",children:"Custom"}),Object(o.jsx)("div",{className:"shading-settings__type__custom",children:Object(o.jsx)("div",{className:"shading-color".concat(c.shadingType===W.e.Custom?" shading-color--selected":""),onClick:function(){return E(p)},children:Object(o.jsx)(U.a,{content:Object(o.jsx)(D.a,{color:p,onChange:function(e){return j(e.hex)},onChangeComplete:function(e){return E(e.hex.toLocaleLowerCase())},disableAlpha:!0}),placement:"bottom",children:Object(o.jsx)("div",{className:"shading-color__fill",style:{backgroundColor:p}})})})})]})]}):a.type===W.a.Palette?Object(o.jsxs)("div",{className:"settings palette-settings",children:[Object(o.jsxs)(te.a.Group,{name:"paletteOrigin",value:h,onChange:function(e){var t=e.target.value;g(t),t===W.c.Custom?P({type:W.a.Palette,paletteType:W.c.Custom,colors:S}):P({type:W.a.Palette,paletteType:W.c.Preset,origin:t,paletteIndex:x[t]})},children:[Object.entries(z.e).map((function(e){var t=Object(u.a)(e,2),a=t[0],n=t[1].name;return Object(o.jsx)(te.a,{value:a,children:n},a)})),Object(o.jsx)(te.a,{value:W.c.Custom,children:"Custom"})]}),Object(o.jsx)("div",{children:h===W.c.Custom?Object(o.jsxs)("div",{className:"palette-settings__custom-palette",children:[Object(o.jsx)(k.a,{className:"custom-palette-number",value:S.length,onChange:function(e){if(e){var t=[].concat(Object($.a)(S.slice(0,e)),Object($.a)(Array.from({length:e-S.length},(function(){return S[S.length-1]||"#aaaaaa"}))));N(t),P({type:W.a.Palette,paletteType:W.c.Custom,colors:t})}},style:{fontSize:"16px"},children:Array.from({length:10},(function(e,t){return Object(o.jsx)(k.a.Option,{value:t+1,style:{fontSize:"16px"},children:t+1},t)}))}),Object(o.jsx)("div",{className:"palette-settings__custom-palette__colors palette-colors",children:S.map((function(e,t){return Object(o.jsx)(U.a,{content:Object(o.jsx)(D.a,{color:e,onChange:function(e){I(e,t)},onChangeComplete:function(e){!function(e,t){var a=I(e,t);P({type:W.a.Palette,paletteType:W.c.Custom,colors:a})}(e,t)},disableAlpha:!0}),placement:"bottom",children:Object(o.jsx)("div",{className:"palette-colors__color",children:Object(o.jsx)("div",{className:"palette-colors__color__fill",style:{backgroundColor:e}})})},t)}))})]}):Object(o.jsx)(k.a,{className:"palette-settings__preset",value:x[h],onChange:function(e){if(h!==W.c.Custom){var t=Object(_.a)({},x);t[h]=e,y(t),P({type:W.a.Palette,paletteType:W.c.Preset,origin:h,paletteIndex:e})}},children:z.e[h].palettes.map((function(e,t){return Object(o.jsx)(k.a.Option,{value:t,dropdownStyle:{display:"flex",alignItems:"center"},children:Object(o.jsx)("div",{className:"palette-colors",children:e.map((function(e){return Object(o.jsx)("div",{className:"palette-colors__color",children:Object(o.jsx)("div",{className:"palette-colors__color__fill",style:{backgroundColor:e}})},e)}))})},t)}))})})]}):null}),ne=function(e){var t=e.specificColorTransforms,a=e.setNewSpecificColorTransforms,n=e.colorConfig,c=e.setColorConfig,r=Object(d.useState)(n.type===W.a.Shading?n:z.d),s=Object(u.a)(r,2),i=s[0],l=s[1],b=Object(d.useState)(n.type===W.a.Palette?n:z.c),p=Object(u.a)(b,2),j=p[0],f=p[1],m=Object(d.useState)({}),h=Object(u.a)(m,2),g=h[0],O=h[1];Object(d.useEffect)((function(){var e={};for(var a in t){var n=t[a];e[a]=n.color?n.color:""}O(e)}),[t]);var v=function(e,t){var a=Object(_.a)({},g);a[t]=e.hex.toLocaleLowerCase(),O(a)};return Object(o.jsxs)("div",{children:[Object(o.jsx)("div",{className:"color-choice__configs",children:Object.entries(z.b).map((function(e){var t=Object(u.a)(e,2),a=t[0],r=t[1];return Object(o.jsxs)("div",{className:"color-choice__configs__config".concat(n.type===a?" color-choice__configs__config--selected":""),onClick:function(){var e;(e=a)===W.a.Random?c(z.f):e===W.a.Shading?c(i):c(j)},children:[Object(o.jsx)("div",{children:r.name}),Object(o.jsx)("img",{className:"color-config-image".concat(n.type===a?" color-config-image--selected":""),width:"80px",alt:a,src:r.imgPath})]},a)}))}),Object(o.jsx)(ae,{colorConfig:n,setColorConfig:c,shadingColorConfig:i,setShadingColorConfig:l,paletteColorConfig:j,setPaletteColorConfig:f}),Object(o.jsx)(N.a,{}),Object(o.jsxs)("div",{className:"specific-colors",children:[Object(o.jsx)(T.a,{level:4,children:"Color Overrides"}),Object(o.jsx)("div",{className:"specific-colors__content",children:Object.entries(t).map((function(e){var c=Object(u.a)(e,2),r=c[0],s=c[1];return Object(o.jsxs)("div",{className:"specific-colors__color",children:[Object(o.jsx)(B.a,{checked:null!==s.color,onChange:function(e){return function(e,c){var o=Object(_.a)({},t);o[e].color=c.target.checked?Y(Q(X(n))):null,a(o)}(r,e)},className:"specific-color-checks__check",children:"Same color for ".concat(s.name)}),s.color&&Object(o.jsx)(U.a,{content:Object(o.jsx)(D.a,{color:g[r],onChange:function(e){v(e,r)},onChangeComplete:function(e){!function(e,n){v(e,n);var c=Object(_.a)({},t);c[n].color=e.hex.toLocaleLowerCase(),a(c)}(e,r)},disableAlpha:!0}),children:Object(o.jsx)("div",{className:"palette-colors__color",children:Object(o.jsx)("div",{className:"palette-colors__color__fill",style:{backgroundColor:g[r]}})})}),Object(o.jsx)("br",{})]},r)}))})]})]})},ce=29.7/21;!function(e){e.A4="A4",e.A3="A3",e.A2="A2",e.A1="A1",e.A0="A0"}(c||(c={}));var oe,re=(n={},Object(l.a)(n,c.A4,29.7),Object(l.a)(n,c.A3,42),Object(l.a)(n,c.A2,59.4),Object(l.a)(n,c.A1,84.1),Object(l.a)(n,c.A0,118.9),n),se=[c.A4,c.A3,c.A2,c.A1,c.A0],ie=a(141),le=a(109),ue=(oe={},Object(l.a)(oe,le.b.Relief,{url:"mapbox://styles/cartapuce/ckhf6cuex07dd19piqg029oka",name:"Relief",imgPath:"https://firebasestorage.googleapis.com/v0/b/maposaic-99785.appspot.com/o/app_assets%2Frelief-alpes.png?alt=media&token=add862d4-3a5e-49ff-aa1f-57b98543050a"}),Object(l.a)(oe,le.b.Road,{url:"mapbox://styles/cartapuce/ck8vk01zo2e5w1ipmytroxgf4",name:"Roads",imgPath:"https://firebasestorage.googleapis.com/v0/b/maposaic-99785.appspot.com/o/app_assets%2Fstreet-paris-fourche.png?alt=media&token=b247c027-eab3-4804-b08c-4fa971432f52"}),Object(l.a)(oe,le.b.Water,{url:"mapbox://styles/cartapuce/ck8ynyj0x022h1hpmffi87im9",name:"Water land",imgPath:"https://firebasestorage.googleapis.com/v0/b/maposaic-99785.appspot.com/o/app_assets%2Fwater-loire.png?alt=media&token=1b986519-854e-433e-bbc0-81b974a77a39"}),Object(l.a)(oe,"administrative",{url:"mapbox://styles/cartapuce/ck8vkvxjt27z71ila3b3jecka",name:""}),Object(l.a)(oe,"satellite",{url:"mapbox://styles/mapbox/satellite-v9",name:""}),Object(l.a)(oe,"regular",{url:"mapbox://styles/mapbox/streets-v11",name:""}),oe),de=function(e){var t=Math.floor((e||0)/6e4),a=(e||0)%6e4,n=Math.floor(a/1e3),c=Math.floor(a%1e3/100);return"".concat(t>0?"".concat(t,":"):"").concat(t&&n<10?"0".concat(n):n).concat(t>0?"":".".concat(c,"s"))},be={display:"flex",justifyContent:"center",alignItems:"center"},pe=function(e){var t=e.visible,a=e.setDrawerVisible,n=e.mapboxStyle,r=e.changeMapStyle,s=e.sizeFactor,i=e.setNewSizeFactor,l=e.colorConfig,b=e.setColorConfig,p=e.specificColorTransforms,j=e.setNewSpecificColorTransforms,h=e.remainingTime,g=e.estimatedTime,O=e.updateEstimatedTime,v=e.onPosterSizeChange,x=Object(d.useState)(s),y=Object(u.a)(x,2),C=y[0],w=y[1],I=Object(d.useState)(null),B=Object(u.a)(I,2),U=B[0],D=B[1],z=Object(d.useState)(c.A4),W=Object(u.a)(z,2),F=W[0],Z=W[1];Object(d.useEffect)((function(){return w(s)}),[s]);return Object(o.jsxs)(S.a,{visible:t,placement:"left",onClose:function(){return a(!1)},closable:!0,width:"min(100%,333px)",children:[Object(o.jsx)(T.a,{level:3,children:"Colors"}),Object(o.jsx)(ne,{colorConfig:l,setColorConfig:b,specificColorTransforms:p,setNewSpecificColorTransforms:j}),Object(o.jsx)(N.a,{}),Object(o.jsx)(T.a,{level:3,children:"Background"}),Object(o.jsx)("div",{className:"drawer__backgroungs",children:Object.values(le.b).map((function(e){return Object(o.jsxs)("div",{className:"drawer__backgroungs__background".concat(n===e?" drawer__backgroungs__background--selected":""),onClick:function(){return r(e)},children:[Object(o.jsx)("div",{children:ue[e].name}),Object(o.jsx)("img",{className:"background-image".concat(n===e?" background-image--selected":""),width:"80px",alt:e,src:ue[e].imgPath})]},e)}))}),Object(o.jsx)(N.a,{}),Object(o.jsx)(T.a,{level:3,children:"Poster"}),Object(o.jsxs)("div",{className:"poster-options",children:[Object(o.jsx)(k.a,{value:F,onSelect:function(e){Z(e),null===U&&D(!0),v({isLandscape:null===U||void 0===U||U,pixelPerInchResolution:300,longerPropertyCMLength:re[e]})},children:se.map((function(e){return Object(o.jsx)(k.a.Option,{value:e,children:e},e)}))}),Object(o.jsxs)(P.a.Group,{style:{display:"flex",alignItems:"center"},name:"preset",onChange:function(e){D(e.target.value),v({isLandscape:e.target.value,pixelPerInchResolution:300,longerPropertyCMLength:re[F]})},value:U,size:"small",className:"poster-options__landscape",children:[Object(o.jsx)(P.a.Button,{style:Object(_.a)({width:"29px",height:"21px"},be),value:!0,children:"A"}),Object(o.jsx)(P.a.Button,{style:Object(_.a)({width:"21px",height:"29px",marginLeft:"12px"},be),value:!1,children:"A"})]})]}),Object(o.jsx)(N.a,{}),Object(o.jsxs)(T.a,{level:3,children:["Scale",Object(o.jsx)(f.a,{className:"scale-tooltip",title:"Increase size and... waiting time",children:Object(o.jsx)(A.a,{})})]}),Object(o.jsxs)("div",{className:"scale",children:[Object(o.jsx)(E.a,{min:0,max:10,step:.1,value:Math.round(10*C)/10,onChange:function(e){void 0!==e&&"string"!==typeof e&&(O(e),w(e))},style:{width:"68px"}}),Object(o.jsx)(m.a,{className:"scale__paint",disabled:s===C,onClick:function(){i(C)},icon:Object(o.jsx)(L.a,{}),children:"Apply"}),(h||g)&&Object(o.jsx)(R.a,{className:"scale__time",count:Object(o.jsx)(M.a,{style:{color:ie.b}}),children:Object(o.jsx)("span",{className:"scale__time__box",children:de(h||g)})})]})]})};function je(){return new Worker(a.p+"static/js/paint.worker.c6695722.worker.js")}a(469),a(43);var fe,me=function(e){var t=document.getElementById("mapbox-wrapper"),a=document.getElementById("maposaic-canvas");t&&a&&(t.style.opacity=e?"1":"0",a.style.opacity=e?"0":"1")},he=a(256),ge="pk.eyJ1IjoiY2FydGFwdWNlIiwiYSI6ImNrODMxdHRmZDE0amQzZXJ1ajF0dW5kbW0ifQ.g27aSLVjhV1XY_9GAJ7eeQ";!function(e){e.Poi="poi",e.Address="address",e.Neighborhood="neighborhood",e.Locality="locality",e.Postcode="postcode",e.Place="place",e.District="district",e.Region="region",e.Country="country"}(fe||(fe={}));var Oe="https://api.mapbox.com/geocoding/v5/mapbox.places",ve=[fe.Place,fe.Locality,fe.Postcode,fe.District,fe.Region,fe.Country,fe.Neighborhood],xe=function(){var e=Object(i.a)(s.a.mark((function e(t){var a,n,c,o,r,i,l,u,d,b;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",null);case 2:return e.next=4,fetch("".concat(Oe,"/").concat(t.lng,",").concat(t.lat,".json?access_token=").concat(ge));case 4:return a=e.sent,e.next=7,a.json();case 7:n=e.sent,c=Object(F.a)(ve),e.prev=9,c.s();case 11:if((o=c.n()).done){e.next=47;break}r=o.value,i=Object(F.a)(n.features),e.prev=14,i.s();case 16:if((l=i.n()).done){e.next=37;break}u=l.value,d=Object(F.a)(u.place_type),e.prev=19,d.s();case 21:if((b=d.n()).done){e.next=27;break}if(b.value!==r){e.next=25;break}return e.abrupt("return",u.place_name);case 25:e.next=21;break;case 27:e.next=32;break;case 29:e.prev=29,e.t0=e.catch(19),d.e(e.t0);case 32:return e.prev=32,d.f(),e.finish(32);case 35:e.next=16;break;case 37:e.next=42;break;case 39:e.prev=39,e.t1=e.catch(14),i.e(e.t1);case 42:return e.prev=42,i.f(),e.finish(42);case 45:e.next=11;break;case 47:e.next=52;break;case 49:e.prev=49,e.t2=e.catch(9),c.e(e.t2);case 52:return e.prev=52,c.f(),e.finish(52);case 55:return e.abrupt("return",null);case 56:case"end":return e.stop()}}),e,null,[[9,49,52,55],[14,39,42,45],[19,29,32,35]])})));return function(t){return e.apply(this,arguments)}}(),ye=function(){var e=Object(i.a)(s.a.mark((function e(){var t,a,n,c,o,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("https://us-central1-maposaic-99785.cloudfunctions.net/fetch3Geonames");case 3:return o=e.sent,e.next=6,o.json();case 6:return r=e.sent,e.abrupt("return",new j.a.LngLat(null!==(t=null===(a=r.geodata.nearest[0])||void 0===a?void 0:a.longt[0])&&void 0!==t?t:2.338272,null!==(n=null===(c=r.geodata.nearest[0])||void 0===c?void 0:c.latt[0])&&void 0!==n?n:48.858796));case 10:return e.prev=10,e.t0=e.catch(0),e.abrupt("return",new j.a.LngLat(100*Math.random(),50*Math.random()+10));case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(){return e.apply(this,arguments)}}(),Ce=function(){return 13*Math.random()+3},we=a(515),_e=(a(470),function(e){var t=e.placeName,a=e.showPlaceNameTrigger,n=Object(d.useState)(!1),c=Object(u.a)(n,2),r=c[0],s=c[1],i=Object(d.useState)(!0),l=Object(u.a)(i,2),b=l[0],p=l[1];Object(d.useEffect)((function(){a&&p(!1)}),[b,a]);var j=Object(d.useRef)();Object(d.useEffect)((function(){if(!j.current&&a){if(r)return;s(!0),setTimeout((function(){return s(!1)}),4e3)}j.current=a}),[a]);var f=function(){s(!r)};return Object(o.jsxs)("div",{className:"place-name ".concat(r?"place-name--displayed":b?"place-name--hidden":"place-name--hidden place-name--hidden--animation"),onClick:f,children:[Object(o.jsx)(m.a,{className:"show-place-name",shape:"circle",onClick:f,icon:Object(o.jsx)(we.a,{})}),Object(o.jsx)("div",{className:"place-name__text",children:null!==t&&void 0!==t?t:"..."})]})}),Se=a(471),Ne=a(497),ke=a(503),Pe=a(511),Ee=a(516),Ie=function(e){var t=e.flyTo,a=e.currentCenter,n=e.setDrawerVisible,c=e.className,r=Object(d.useState)(""),l=Object(u.a)(r,2),b=l[0],p=l[1],f=Object(d.useState)([]),m=Object(u.a)(f,2),h=m[0],g=m[1],O=Object(d.useState)(!1),v=Object(u.a)(O,2),x=v[0],y=v[1],C=function(){var e=Object(i.a)(s.a.mark((function e(t){var n,c,o,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(p(t),!(t.length<1)){e.next=4;break}return g([]),e.abrupt("return");case 4:return y(!0),n=a?"&proximity=".concat(a.lng,"%2C").concat(a.lat):"",c="".concat(Oe,"/").concat(t,".json?limit=10&language=fr-FR&access_token=").concat(ge).concat(n),e.next=9,fetch(c);case 9:return o=e.sent,e.next=12,o.json();case 12:r=e.sent,y(!1),g(r.features);case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),w=h.map((function(e){var t=e.place_name.split(","),a=Object(Se.a)(t),n=a[0],c=a.slice(1);return{value:e.id,label:Object(o.jsxs)("div",{children:[Object(o.jsx)("div",{style:{fontWeight:500},children:n}),Object(o.jsx)("div",{children:c.join("")})]})}}));return Object(o.jsx)(Ne.a,{className:c,onSearch:C,onSelect:function(e){var a=h.find((function(t){return t.id===e}));a&&(n(!1),t(new j.a.LngLat(a.center[0],a.center[1])))},value:b,placeholder:"Search place",options:w,children:Object(o.jsx)(ke.a,{style:{borderRadius:"16px"},suffix:x?Object(o.jsx)(Pe.a,{}):Object(o.jsx)(Ee.a,{})})})},Te=a(187),Ae=a(492),Le=b.a.lazy((function(){return Promise.resolve().then(a.bind(null,492))}));j.a.accessToken=ge;var Re=null,Me=new je,Be=function(e){var t,a=e.getCanvas().getContext("webgl");return(null!==(t=null===a||void 0===a?void 0:a.drawingBufferWidth)&&void 0!==t?t:0)*((null===a||void 0===a?void 0:a.drawingBufferHeight)||0)},Ue={pixelCount:null,milliseconds:null},De=new Date;t.default=function(){var e,t=Object(v.f)(),a=Object(d.useState)(!1),n=Object(u.a)(a,2),c=n[0],r=n[1],b=Object(d.useState)(!1),p=Object(u.a)(b,2),_=p[0],S=p[1],N=Object(d.useState)(null),k=Object(u.a)(N,2),P=k[0],E=k[1],I=Object(d.useRef)(null),T=Object(d.useState)(!1),A=Object(u.a)(T,2),L=A[0],R=A[1],M=Object(d.useState)(null),B=Object(u.a)(M,2),U=B[0],D=B[1],W=Object(d.useState)(null),F=Object(u.a)(W,2),Z=F[0],G=F[1],H=Object(d.useState)(le.b.Relief),V=Object(u.a)(H,2),J=V[0],Y=V[1],Q=Object(d.useState)(z.f),X=Object(u.a)(Q,2),K=X[0],$=X[1],ee=Object(d.useState)(!0),te=Object(u.a)(ee,2),ae=te[0],ne=te[1],oe=Object(d.useState)(null),re=Object(u.a)(oe,2),se=re[0],ie=re[1],de=Object(d.useState)(null),be=Object(u.a)(de,2),fe=be[0],ge=be[1],Oe=Object(d.useState)(0),ve=Object(u.a)(Oe,2),we=ve[0],Se=ve[1],Ne=Object(d.useState)(1),ke=Object(u.a)(Ne,2),Pe=ke[0],Ee=ke[1],ze=Object(d.useState)(null),We=Object(u.a)(ze,2),Fe=We[0],Ze=We[1],Ge=Object(d.useState)(Ce()),He=Object(u.a)(Ge,2),Ve=He[0],Je=He[1],Ye=Object(d.useState)(!1),Qe=Object(u.a)(Ye,2),Xe=Qe[0],qe=Qe[1],Ke=Object(d.useState)(!1),$e=Object(u.a)(Ke,2),et=$e[0],tt=$e[1],at=Object(d.useState)((e={},Object(l.a)(e,"#ffffff",{color:z.g,isEditable:!0,name:"roads"}),Object(l.a)(e,"#75cff0",{color:null,isEditable:!0,name:"water"}),e)),nt=Object(u.a)(at,2),ct=nt[0],ot=nt[1];Object(d.useEffect)((function(){if(se&&P){var e=Object(Te.c)(se,P.getZoom(),new URLSearchParams(window.location.search));window.history.replaceState({},"","".concat(window.location.pathname,"?").concat(e))}}),[se,P]),Object(Te.d)(r),Object(d.useEffect)((function(){if(_){var e=Object(Te.b)(K,new URLSearchParams(window.location.search));window.history.replaceState({},"","".concat(window.location.pathname,"?").concat(e))}}),[K,_]),Object(d.useEffect)((function(){if(_){var e=new URLSearchParams(window.location.search);e.set(le.a,J),window.history.replaceState({},"","".concat(window.location.pathname,"?").concat(e))}}),[J,_]);var rt=function(){var e=Object(i.a)(s.a.mark((function e(){var t,a,n=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=!(n.length>0&&void 0!==n[0])||n[0],ne(!0),e.next=4,ye();case 4:if(a=e.sent,tt(!0),null===Ve&&t&&Je(Ce()),Fe){e.next=10;break}return Ze(a),e.abrupt("return");case 10:if(P){e.next=12;break}return e.abrupt("return");case 12:P.setCenter(a),t&&P.setZoom(Ce());case 14:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Object(d.useEffect)((function(){var e=new URLSearchParams(window.location.search),t=e.get(le.d.Lat),a=e.get(le.d.Lng),n=e.get(le.d.Zoom);t&&a?Ze(new j.a.LngLat(parseFloat(a),parseFloat(t))):rt(!n),n&&Je(parseFloat(n));var c=Object(Te.a)(new URLSearchParams(window.location.search));c&&$(c);var o=e.get(le.a);o&&Object.values(le.b).includes(o)&&Y(o),S(!0)}),[]),Object(d.useEffect)((function(){var e,t,a=function(e){ne(!0),me(!0);var t=e.getCanvas().getContext("webgl"),a=document.getElementById("mapbox-wrapper"),n=document.getElementById("maposaic-canvas");if(t&&t.drawingBufferWidth&&n){var o,r,s={w:t.drawingBufferWidth,h:t.drawingBufferHeight},i=(o=s,r=1,{w:Math.ceil(o.w/r),h:Math.ceil(o.h/r)});null===Re&&(Re=t.drawingBufferWidth/((null===a||void 0===a?void 0:a.offsetWidth)||1)),n.setAttribute("width",i.w.toString()),n.setAttribute("height",i.h.toString());var l=n.getContext("2d");if(l){var u=l.getImageData(0,0,i.w,i.h),d=u.data,b=new Uint8Array(t.drawingBufferWidth*t.drawingBufferHeight*4);t.readPixels(0,0,t.drawingBufferWidth,t.drawingBufferHeight,t.RGBA,t.UNSIGNED_BYTE,b),Me.postMessage({sourcePixelArray:b,targetPixelArray:d,sourceSize:s,targetSize:i,canvassRatio:1,maposaicColors:q(K,ct),specificColorTransforms:ct,isWasmAvailable:c}),Me.onmessage=function(e){var t;u.data.set(e.data.pixels,e.data.paintedBoundsMin),l.putImageData(u,0,0),me(!1),ne(!1),G(0);var a=Math.floor(e.data.pixels.length/4),n=(new Date).getTime()-De.getTime();a>=(null!==(t=Ue.pixelCount)&&void 0!==t?t:0)&&(Ue.pixelCount=Math.floor(e.data.pixels.length/4),Ue.milliseconds=n),D(n)}}}else console.log("pas de gl")};if(Fe){var n=null!==(e=null===P||void 0===P?void 0:P.getCenter())&&void 0!==e?e:Fe,o=null!==(t=null===P||void 0===P?void 0:P.getZoom())&&void 0!==t?t:Ve;!function(e){var t=document.getElementById("mapbox-wrapper");t&&(t.style.width=(t.offsetWidth*e).toString()+"px",t.style.height=(t.offsetHeight*e).toString()+"px")}(Pe);var r=new j.a.Map({container:I.current?I.current:"",style:ue[J].url,zoom:o,center:n,maxTileCacheSize:0});return r.on("load",(function(){E(r)})),r.on("resize",(function(){Se((function(e){return e+1}))})),r.on("dragstart",me),r.on("zoomstart",me),r.on("render",(function(){if(function(){var e=document.getElementsByClassName("mapboxgl-canvas")[0],t=document.getElementById("mapbox-wrapper");e&&t&&(e.style.width="100%",e.style.height="100%",t.style.width="100%",t.style.height="100%")}(),r.loaded()&&!r.isMoving()&&!r.isZooming()){Me.terminate();var e=Be(r);G(Math.round((Ue.milliseconds||0)*e/(Ue.pixelCount||1))),De=new Date,Me=new je,a(r),r.getCenter().lat!==(null===se||void 0===se?void 0:se.lat)&&r.getCenter().lng!==(null===se||void 0===se?void 0:se.lng)&&ie(r.getCenter())}})),function(){r.remove()}}}),[J,K,we,Pe,ct,Fe,c]);Object(d.useEffect)((function(){if(Z&&!(Z<=0)){var e=setInterval((function(){G(Math.max(Math.round(Z-200),0))}),200);return function(){return clearInterval(e)}}}),[Z]);var st=function(){var e=Object(i.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,xe(se);case 2:t=e.sent,ge(t),et&&(qe(!0),tt(!1));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Object(d.useEffect)((function(){st()}),[se]),Object(d.useEffect)((function(){qe(!1)}),[Xe]);return Object(o.jsxs)("div",{className:"root-wrapper",id:"root-wrapper",children:[Object(o.jsxs)("div",{className:"maps-container",id:"maps-container",children:[Object(o.jsx)("canvas",{className:"mosaic-canvas",id:"maposaic-canvas"}),Object(o.jsx)("div",{id:"mapbox-wrapper",className:"mapbox-wrapper",ref:function(e){return I.current=e}}),Object(o.jsx)(x.a,{className:"maps-container__spin",spinning:ae,indicator:Object(o.jsx)("img",{className:"spinner",src:y.a,alt:"spin"})})]}),Object(o.jsxs)("div",{className:"overmap",children:[Object(o.jsx)(pe,{visible:L,setDrawerVisible:R,changeMapStyle:function(e){me(!0),ne(!0),Y(e)},mapboxStyle:J,colorConfig:K,setColorConfig:function(e){$(e),ne(!0)},sizeFactor:Pe,setNewSizeFactor:function(e){Ee(e),ne(!0)},specificColorTransforms:ct,setNewSpecificColorTransforms:function(e){ot(e),ne(!0)},remainingTime:Z,estimatedTime:U,updateEstimatedTime:function(e){if(P){var t=Be(P);D(Math.round((Ue.milliseconds||0)*t/(Ue.pixelCount||1))*Math.pow(e/Pe,2))}},onPosterSizeChange:function(e){var t,a=e.isLandscape,n=e.pixelPerInchResolution,c=e.longerPropertyCMLength;if(P){var o=document.getElementById("root-wrapper"),r={w:(null===o||void 0===o?void 0:o.offsetWidth)||0,h:(null===o||void 0===o?void 0:o.offsetHeight)||0},s=a?"w":"h",i="h"===s?"w":"h",u=(t={},Object(l.a)(t,i,Math.floor(r[s]/ce)),Object(l.a)(t,s,r[s]),t);u[i]>r[i]&&(u[i]=r[i],u[s]=Math.floor(r[i]*ce)),ne(!0),function(e){var t=document.getElementById("maps-container"),a=document.getElementById("mapbox-wrapper"),n=document.getElementById("maposaic-canvas");t&&a&&n&&(t.style.width=e.w.toString()+"px",t.style.height=e.h.toString()+"px",a.style.width=e.w.toString()+"px",a.style.height=e.h.toString()+"px",n.style.width=e.w.toString()+"px",n.style.height=e.h.toString()+"px")}(u),Se(we+1);var d=c/2.54*n,b=u[s]*(Re||1);Ee(d/b)}}}),Object(o.jsxs)("div",{className:"overmap__actions",children:[Object(o.jsx)(f.a,{title:"Settings",mouseEnterDelay:he.a,children:Object(o.jsx)(m.a,{className:"overmap__actions__button",type:"primary",shape:"circle",onClick:function(){R(!0)},icon:Object(o.jsx)(h.a,{})})}),Object(o.jsx)(f.a,{title:"Download",mouseEnterDelay:he.a,children:Object(o.jsx)(m.a,{className:"overmap__actions__button",type:"default",shape:"circle",onClick:function(){var e=document.getElementById("maposaic-canvas");e&&e.toBlob((function(e){var t=document.createElement("a");t.download=fe?"maposaic - ".concat(fe):"maposaic",t.href=URL.createObjectURL(e),t.click()}))},icon:Object(o.jsx)(g.a,{}),disabled:ae})}),Object(o.jsx)(d.Suspense,{fallback:Object(o.jsx)(Ae.UploadButton,{isDisabled:!0}),children:Object(o.jsx)(Le,{mapZoom:null===P||void 0===P?void 0:P.getZoom(),mapCenter:null===P||void 0===P?void 0:P.getCenter(),mapboxStyle:J,colorConfig:K,placeName:fe,className:"overmap__actions__button",isDisabled:ae})}),Object(o.jsx)(f.a,{title:"Visit gallery",children:Object(o.jsx)(m.a,{className:"overmap__actions__button",onClick:function(){t.push("/gallery")},shape:"circle",icon:Object(o.jsx)(O.a,{})})})]}),Object(o.jsxs)("div",{className:"overmap__actions",children:[Object(o.jsx)(Ie,{className:"overmap__actions__button",flyTo:function(e){P&&(me(!0),ne(!0),P.setCenter(e))},currentCenter:se,setDrawerVisible:R}),Object(o.jsx)(f.a,{title:"Random place",mouseEnterDelay:he.a,children:Object(o.jsx)(m.a,{className:"overmap__actions__button",style:{display:"flex",justifyContent:"center",alignItems:"center"},shape:"circle",onClick:function(){return rt(!0)},icon:Object(o.jsx)("img",{src:C,width:"16px",alt:"dice"})})}),Object(o.jsx)(m.a,{onClick:function(){P&&(ne(!0),navigator.geolocation?navigator.geolocation.getCurrentPosition((function(e){P.setCenter(new j.a.LngLat(e.coords.longitude,e.coords.latitude))}),(function(){return ne(!1)})):(ne(!1),console.log("Geolocation is not supported by your browser")))},className:"overmap__actions__button",shape:"circle",icon:Object(o.jsx)("img",{src:w,width:"16px",alt:"gps"})})]})]}),Object(o.jsx)(_e,{showPlaceNameTrigger:Xe,placeName:fe})]})}}}]);
//# sourceMappingURL=7.24eab433.chunk.js.map